# 生成和调用自定义的消息类型

- 生成时：

1. 在`package.xml中`：
   1.1 增加`message_generation` 这种`build_depend` tag 

   1.2 增加`message_runtime` 这种`exec_depend` tag

2. 在`CMakeLists.txt`中：

   2.1 增加依赖 `message_generation` 到 `find_package(catkin REQUIRED COMPONENTS ...)` 

   2.1 add\_*\_files这部分内容选择性取消注释，添加`.msg`文件

   2.2 `generate_messages`这部分内容选择性取消注释，`generate_messages(DEPENDENCIES ...）`中添加依赖的包名



- 调用时：

1. 在`package.xml中`：

   1.1 增加包的`build_depend` tag和`exec_depend` tag 

2. 在`CMakeLists.txt`中：

   2.1 将相关信息类型包添加到`find_package`即可

   

## 实例

### 生成自定义的消息类型

1. 创建一个简易package

```bash
$ catkin_create_pkg msg_test01 rospy  generate_messages
```

2. 创建`CMakeLists.txt`（追加）

```cmake
cmake_minimum_required(VERSION 3.0.2)
project(msg_test01)

find_package(catkin REQUIRED COMPONENTS
  message_generation
  rospy
)

## 生成自定义的消息类型（build阶段，生成在build/下）
add_message_files(
  # DIRECTORY (arg) 指定文件夹
  FILES  # 指定文件夹
  test01.msg
)

#  根据依赖，生成msg源文件（run阶段，生成在devel/下）
generate_messages(
#   DEPENDENCIES   有依赖时需取消#
#   std_msgs  # Or other packages containing msgs
)

catkin_package(
  CATKIN_DEPENDS message_runtime rospy
)
```

3. 创建`package.xml`

```xml
<?xml version="1.0"?>
<package format="2">
  <name>msg_test01</name>
  <version>0.0.0</version>
  <description>The msg_test01 package</description>

  <maintainer email="helios@todo.todo">helios</maintainer>

  <license>TODO</license>

  <buildtool_depend>catkin</buildtool_depend>
  
  <build_depend>rospy</build_depend>
  <exec_depend>rospy</exec_depend>

  <build_depend>message_generation</build_depend>
  <exec_depend>message_runtime</exec_depend>
  
</package>
```



### 调用自定义的消息类型

1. 创建一个简易package

```bash
$ catkin_create_pkg msg_test01 rospy
```

2. 创建CMakeLists.txt

```cmake
cmake_minimum_required(VERSION 3.0.2)
project(msg_test02)

find_package(catkin REQUIRED COMPONENTS
  msg_test01
  rospy
)
```

3. 创建`package.xml`

```python
<?xml version="1.0"?>
<package format="2">
  <name>msg_test02</name>
  <version>0.0.0</version>
  <description>The msg_test02 package</description>
  <maintainer email="helios@todo.todo">helios</maintainer>
  <license>TODO</license>

  <buildtool_depend>catkin</buildtool_depend>

  <build_depend>msg_test01</build_depend>
  <exec_depend>msg_test01</exec_depend>

  <build_depend>rospy</build_depend>
  <exec_depend>rospy</exec_depend>

</package>

```

4. 创建`msg_test02.py`创建自定义的消息类型（生成的`python msg module`在 `devel/lib/python2.7/dist-packages/`中）

```python
import rospy
from msg_test01.msg import test01   # 注意此处import的有msg

rospy.init_node('msg_test01', anonymous=False)
test01 = test01()
```



## 未整理

- 要使用别的包的消息类型，需要加全前缀，例如`geometry_msgs/Twist Base`
- depend = exec_depend + build_depend



