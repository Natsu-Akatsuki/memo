03.拓展工具
============

1.宏配置
----------------

- `dgb <https://github.com/sharkdp/dbg-macro>`_ (用于替代cout和printf的宏)

.. code-block:: bash

    # 安装方式：对头文件进行软链接
    $ git clone https://github.com/sharkdp/dbg-macro
    $ sudo ln -s $(readlink -f dbg-macro/dbg.h) /usr/include/dbg.h

.. role:: raw-html-m2r(raw)
   :format: html


2.distcc分布式编译
-------------------

.. code-block:: bash

   # 服务端和客户端均安装distcc
   $ sudo apt install distcc # 服务端配置
   

   # 客户端配置
   $ export DISTCC_VERBOSE=1 DISTCC_LOG=/tmp/distcc.log  # optional just for debug
   $ CC="distcc gcc" CXX="distcc g++" cmake ..
   # 指定服务端
   $ export DISTCC_HOSTS='ah_chung@10.23.21.110/32 localhost/2'
   $ make -j$(distcc -j)

   # 服务端设置
   $ sudo distccd --daemon --allow 10.23.21.1/24 
   --log-file /var/log/distccd.log --log-level=debug 
   --jobs 32 
   --pid-file=/var/run/distccd.pid

.. note:: 
   服务端/volunteer即接收请求，执行编译，启动distccd后台进程的主机；客户端即有源代码待编译，发布编译请求的主机

.. note:: 
   ``allow`` option指的是允许哪些client与当前server相连; 
   ``DISTCC_HOSTS`` 反斜杠后的数字代表指派的进程数

显示调度信息
^^^^^^^^^^^^

在client端显示调度的信息

.. code-block:: bash

   # 在终端显示调度信息 
   $ distccmon-text 
   # 使用gui显示调度信息 
   $ distccmon-gnome`

.. image:: https://natsu-akatsuki.oss-cn-guangzhou.aliyuncs.com/img/TUMxoGdTc2OYOFRZ.png!thumbnail
   :target: https://natsu-akatsuki.oss-cn-guangzhou.aliyuncs.com/img/TUMxoGdTc2OYOFRZ.png!thumbnail
   :alt: img

拓展应用
^^^^^^^^^^^^
- catkin build中使用distcc

.. code-block:: bash

   $ CC="distcc gcc" CXX="distcc g++" catkin build -j$(distcc -j) -p$(distcc -j)


scrap
^^^^^^^^^

* 配置文档：\ ``/etc/default/distcc``\ （实际使用时基本没用上，直接在命令行指定）
* 
  `exit code <https://github.com/distcc/distcc/blob/master/src/exitcode.h>`_

* 
  `pcl使用distcc实现分布式编译 <https://pcl.readthedocs.io/projects/advanced/en/latest/distcc.html>`_\ （当前问题为在编译到49%时会卡住，出现107错误，过很长一段时间才会恢复正常）

* 后台进程102错误时，可以尝试restart重启服务


.. image:: https://natsu-akatsuki.oss-cn-guangzhou.aliyuncs.com/img/0uJtmvlGKud5nBLX.png!thumbnail
   :target: https://natsu-akatsuki.oss-cn-guangzhou.aliyuncs.com/img/0uJtmvlGKud5nBLX.png!thumbnail
   :alt: img

* distcc分布式编译会受限于网络带宽
    
.. include:: 拓展工具/gdb/gdb.rst