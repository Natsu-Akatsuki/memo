# 性能分析工具

## [火焰图(flameGraph)](https://github.com/brendangregg/FlameGraph)（分析CPU usage情况）

- 安装(for ubuntu)

```bash
# 安装依赖perf
$ sudo apt install linux-tools-common linux-tools-generic linux-cloud-tools-generic \
	linux-tools-$(uname -r) linux-cloud-tools-$(uname -r)
# 导入生成火焰图的相关脚本
$ git clone https://github.com/brendangregg/FlameGraph.git
```

- 生成火焰图的步骤

  ![image-20210904163304591](https://natsu-akatsuki.oss-cn-guangzhou.aliyuncs.com/img/image-20210904163304591.png)

步骤一：记录调用栈信息

```bash
$ sudo perf record -F 99 -p <pid> -g -- sleep 60
$ perf script > out.perf
```

---

**NOTE**

1. capture可用不同的工具，比如`perf`、`DTrace`
2. `perf record` options项

<img src="https://natsu-akatsuki.oss-cn-guangzhou.aliyuncs.com/img/rW2spgg55hXiLfqw.png!thumbnail" alt="img" style="zoom:67%;" />

---

步骤二：折叠(fold)调用栈信息

```bash
$ ./stackcollapse-perf.pl out.perf > out.folded
```

步骤三：生成(render)火焰图

```bash
$ ./flamegraph.pl out.folded > out.svg
```

### 拓展资料

https://www.cnblogs.com/arnoldlu/p/10148558.html

https://blog.csdn.net/qq_25072517/article/details/78433756



## gdb

- 快捷键（已掌握）

|        作用         |         快捷键          |
| :-----------------: | :---------------------: |
| (info) 查看虚函数表 |        info vtlb        |
|   (info) 查看变量   | p/print <variable_name> |
| (info) 查看线程信息 |      info threads       |

[链接](../pdf资料/cheatsheet/GDBCheatSheet.pdf)



# 实战

## gps_driver_node CPU占用率高

- 使用`gdb`查看调用栈

```promt bash
$ 
```





<img src="https://natsu-akatsuki.oss-cn-guangzhou.aliyuncs.com/img/image-20210904231313853.png" alt="image-20210904231313853" style="zoom:67%;" />

![image-20210904231440248](https://natsu-akatsuki.oss-cn-guangzhou.aliyuncs.com/img/image-20210904231440248.png)
