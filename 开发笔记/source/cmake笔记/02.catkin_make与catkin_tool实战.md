# 02. catkin_make&catkin_tool实战

<p align="right">Author: kuzen, Natsu-Akatsuki</p>

## catkin_make

### 单独编译某些package

```bash
$ catkin_make -DCATKIN_WHITELIST_PACKAGES="package1;package2"
# 等价于：
$ catkin_make --only-pkg-with-deps
# 撤销白名单设置
$ catkin_make -DCATKIN_WHITELIST_PACKAGES=""
```

.. note:: 要屏蔽某些包被编译，可以创建一个名为[CATKIN_IGNORE](https://github.com/tier4/velodyne_vls/tree/tier4/master/velodyne_msgs)的文件到这些包所在的目录下

### 使用ninja编译

```bash
$ catkin_make --use-ninja
```

.. note:: `catkin_make` 用 `ninja` 编译速度会快些，但对报错信息没有语法高亮，很影响调试

## [catkin build](https://catkin-tools.readthedocs.io/en/latest/index.html)

### [安装catkin build](https://catkin-tools.readthedocs.io/en/latest/installing.html)

### 编译

* 跳过对某些已编译包的编译（实际上只是检查）

```bash
$ catkin build --start-with <pkg>
````

<img src="https://natsu-akatsuki.oss-cn-guangzhou.aliyuncs.com/img/dIW8tcn1J6m2KYLp.png!thumbnail" alt="img" style="zoom:67%; " />

* 配置编译参数

```bash
$ catkin config -DPYTHON_EXECUTABLE=/opt/conda/bin/python3 \
-DPYTHON_INCLUDE_DIR=/opt/conda/include/python3.8 \
-DPYTHON_LIBRARY=/opt/conda/lib/libpython3.8.so
# 使用catkin_make参数
$ catkin config --catkin-make-args [args]
```

* 配置黑白名单

```bash
# 配置白名单（或黑名单）
$ catkin config --whitelist/blacklist <pkg>
# 取消白名单配置
$ catkin config --no-whitelist  
```

* 追加和移除而非覆盖配置参数

```bash
# 追加配置参数
$ catkin config -a <配置参数>
# 移除配置参数
$ catkin config -r <配置参数>
```

* 编译当前文件夹下的`package`

```bash
$ catkin build --this
```

* [缓存Environment来提高编译速度](https://catkin-tools.readthedocs.io/en/latest/verbs/catkin_config.html?highlight=cache#accelerated-building-with-environment-caching)

```bash
$ catkin config/build --env-cache
$ catkin config/build --no_env_cache
```

.. todo:: 暂未比较过编译时间的差别

### 清理编译产物

```bash
# 指定删除某个package
$ catkin clean <package_name>
# 删除所有 product 
$ catkin clean --deinit
# 移除非src文件夹下的包的编译产物 
$ catkin clean --orphans
```

.. note:: `catkin clean` 默认删除 `devel` 、 `log` 等目录，但隐藏目录 `.catkin_tools` , `.catkin_workspace` 不会清除

### [配置文档](https://catkin-tools.readthedocs.io/en/latest/verbs/catkin_profile.html)

catkin build可以设置配置文档profile

.. todo:: 尚未明晰可用的场景

## DEBUG

### 使用catkin builld编译时显示could not find a package configuration file

<img src="https://natsu-akatsuki.oss-cn-guangzhou.aliyuncs.com/img/image-20210912141918386.png" alt="image-20210912141918386" style="zoom: 80%; " />

一般来说catkin build不用像catkin_make一样，需要在cmakelists中指明依赖关系，其能够合理地安排编译顺序，会出现上述问题可检查一波 `package.xml` 是否写好了build tag

<img src="https://natsu-akatsuki.oss-cn-guangzhou.aliyuncs.com/img/AYu9WKlHPlES5yu7.png!thumbnail" alt="img" style="zoom:67%; " />

## 拓展工具

### [catkin-lint](https://fkie.github.io/catkin_lint/)

静态查看catkin工程错误

```bash
# 安装
$ sudo apt install catkin-lint
# example
$ catkin_lint -W0 .
```

![image-20210912200754563](https://natsu-akatsuki.oss-cn-guangzhou.aliyuncs.com/img/image-20210912200754563.png)

.. note:: catkin_lint相关提示信息仅供参考，不一定准确
