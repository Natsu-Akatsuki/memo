.. role:: raw-html-m2r(raw)
   :format: html


03. 终端和界面配置与shell脚本
=============================

`tmux <https://manpages.ubuntu.com/manpages/focal/en/man1/tmux.1.html>`_\ （终端复用）
----------------------------------------------------------------------------------------

安装
^^^^

.. prompt:: bash $,# auto

   $ sudo apt install -y tmux

配置文档
^^^^^^^^

触发配置文档生效

.. prompt:: bash $,# auto

   $ tmux source ~/.tmux.conf`

.. note:: 配置文档所在位置为 `~/.tmux.conf`


分屏
^^^^


.. image:: https://natsu-akatsuki.oss-cn-guangzhou.aliyuncs.com/img/image-20210902091648903.png
   :target: https://natsu-akatsuki.oss-cn-guangzhou.aliyuncs.com/img/image-20210902091648903.png
   :alt: image-20210902091648903


.. prompt:: bash $,# auto

   # 分屏得四宫格(split-window alias:split)
   $ tmux new -s ros
   $ tmux split -v
   $ tmux split -h
   $ tmux select-pane -t 1
   $ tmux split -h

:raw-html-m2r:`<img src="https://natsu-akatsuki.oss-cn-guangzhou.aliyuncs.com/img/image-20210902094739706.png" alt="image-20210902094739706" style="zoom:67%; " />`

pane操作
^^^^^^^^


* 显示panes

.. prompt:: bash $,# auto

   $ tmux list-panes

:raw-html-m2r:`<img src="https://natsu-akatsuki.oss-cn-guangzhou.aliyuncs.com/img/image-20210902092500394.png" alt="image-20210902092500394" style="zoom:67%; " />`


* panes切换

.. prompt:: bash $,# auto

   $ tmux select-pane <-t pane_id>
   # pane id可通过display-panes来知悉

session操作
^^^^^^^^^^^


* 创建session


.. image:: https://natsu-akatsuki.oss-cn-guangzhou.aliyuncs.com/img/image-20210902093923093.png
   :target: https://natsu-akatsuki.oss-cn-guangzhou.aliyuncs.com/img/image-20210902093923093.png
   :alt: image-20210902093923093


常用快捷键
^^^^^^^^^^

该部分快捷键包含自定义的快捷键

.. list-table::
   :header-rows: 1

   * - 作用
     - 快捷键
   * - 分屏：vertical split
     - 前导符+-
   * - 分屏：horizon split
     - 前导符+|
   * - 分屏：panel switch
     - 前导符+o
   * - 游走(navigation)：panel/window 选择性地切换
     - 前导符+w
   * - 粘贴版：显示粘贴板
     - 前导符+w
   * - 粘贴板：粘贴
     - 前导符+p
   * - 粘贴板：选择性粘贴
     - 前导符+P


实战
^^^^

`自定义配置 <https://github.com/Natsu-Akatsuki/MyTmux>`_
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

`复制pane的文字 <https://blog.csdn.net/RobertFlame/article/details/92794332>`_
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

需要在使用前使用 ``shift``

安装tpm
~~~~~~~

安装后，后续可用前导符+I（大写）进行插件安装

.. prompt:: bash $,# auto

   $ git clone https://github.com/tmux-plugins/tpm ~/.tmux/plugins/tpm

面板缩放(zoom)
~~~~~~~~~~~~~~

 ``前导符+z``

terminator（终端复用）
----------------------


* 安装与使用

.. code-block:: bas

   $ sudo apt install terminator
   $ terminator


.. image:: https://natsu-akatsuki.oss-cn-guangzhou.aliyuncs.com/img/HLG3YQFJyk39WIM5.png!thumbnail
   :target: https://natsu-akatsuki.oss-cn-guangzhou.aliyuncs.com/img/HLG3YQFJyk39WIM5.png!thumbnail
   :alt: img



* `常用快捷键 <https://blog.csdn.net/zhangkzz/article/details/90524066>`_

screen（终端复用）
------------------

略

`yakuake（顶部终端） <https://github.com/KDE/yakuake>`_
-----------------------------------------------------------

暂时感觉用处不大

终端常用快捷键
--------------


* `终端的艺术 <https://github.com/jlevy/the-art-of-command-line/blob/master/README-zh.md>`_
* ShortCut Table

.. list-table::
   :header-rows: 1

   * - 快捷键
     - 作用
   * - ctrl+w
     - 删除一个单词
   * - ctrl+7
     - 撤销操作(cancel)
   * - ctrl+u
     - 剪切至开头
   * - ctrl+k
     - 剪切至末尾
   * - ctrl+y
     - 粘贴
   * - ctrl+←/ctrl+→
     - 以单词为单位进行左右跳转
   * - ctrl+#
     - 注释当前命令行


.. attention:: 此处快捷键的剪切板并不是系统的剪切板


界面配置
--------


* 
  界面分为 ``命令行界面`` 和 ``图像化界面``

* 
  ``命令行界面`` ，又称为 ``终端界面``\ ，对应的tty为 ``ttyX``

* 
  ubuntu下默认提供6个 ``终端界面`` 给用户登录，每个终端界面下启动的 ``terminal`` 对应的tty为 ``pts/X``


.. image:: https://natsu-akatsuki.oss-cn-guangzhou.aliyuncs.com/img/e2wbM5698Gcp7CcW.png!thumbnail
   :target: https://natsu-akatsuki.oss-cn-guangzhou.aliyuncs.com/img/e2wbM5698Gcp7CcW.png!thumbnail
   :alt: img


查看某些按键的特殊效果
^^^^^^^^^^^^^^^^^^^^^^

.. prompt:: bash $,# auto

   $ stty -a

`配置特殊的终端效果 <https://www.cnblogs.com/robinunix/p/11635560.html>`_
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

一般用在bash脚本中，该选项对应于 ``bash [option]``

.. prompt:: bash $,# auto

   # 启动调试模式，输出详细的日志（会标准输出当前执行的命令）
   $ set -x
   # 若脚本执行有问题，则直接退出脚本
   $ set -e

切换界面
^^^^^^^^

.. prompt:: bash $,# auto

   # 查询当前默认的界面（命令行界面or终端界面）
   $ systemctl get-default
   # 切换界面(依次为命令行界面和终端界面)
   $ systemctl isolate multi-user.target
   $ systemctl isolate graphical.target
   # 设置默认界面
   $ systemctl set-default graphical.target

终端显示特殊的信息
^^^^^^^^^^^^^^^^^^


* 想要在输入密码时，有提示信息，可修改\ ``/etc/ssh/sshd_config``\ 的\ ``Banner``\ 字段
* 想要在登录界面中，添加提示信息，可

.. prompt:: bash $,# auto

   $ sudo apt install landscape-common
   # 添加bash文件到/etc/update-motd.d/，其中文件顺序从小到大进行执行
   $ ...

拓展工具
--------

录制按键
^^^^^^^^

.. prompt:: bash $,# auto

   $ script <output_file_name>
   # 命令行操作
   # 结束操作
   $ exit

`解析命令行 <https://explainshell.com/>`_
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

shell脚本
---------

首行配置
^^^^^^^^

.. prompt:: bash $,# auto

   # e.g. 用于指明执行当前脚本的执行器
   #!/bin/bash

特殊参数
^^^^^^^^

.. prompt:: bash $,# auto

   $$：查看当前终端的pid 
   $1：取命令行的第1个参数（序号从0开始） 
   ${@:2} ：取所有的参数，取从第2个开始的所有参数 
   $? ：获取上一个命令行返回的exit code
   `

输入输出流重定向
^^^^^^^^^^^^^^^^

.. prompt:: bash $,# auto

   # 1>     标准输出重定向 (dafault)
   # 2>     标准输出错误重定向 
   # 1>&2   标准输出转换为标准输出错误（放置在命令行末尾） 
   # 2>&1   标准输出错误转换为标准输出   （放置在命令行末尾）

   $ echo "hello" 2> /dev/null

`read 函数 <https://linuxcommand.org/lc3_man_pages/readh.html>`_
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

.. prompt:: bash $,# auto

   $ read -r -p "Are You Sure? [Y/n] " input 
   # -p：输入时显示提示信息
   `

bash option
^^^^^^^^^^^


.. image:: https://natsu-akatsuki.oss-cn-guangzhou.aliyuncs.com/img/O3qeGIlZbro6Cifs.png!thumbnail
   :target: https://natsu-akatsuki.oss-cn-guangzhou.aliyuncs.com/img/O3qeGIlZbro6Cifs.png!thumbnail
   :alt: img


.. prompt:: bash $,# auto

   # -i：启动交互式的脚本（若没显式制定-i，bash会根据代码是否有IO交互，隐式加上 -i ）
   # -v：执行脚本前，先显示脚本内容
   # -x：显示正在执行的命令行(commands)和其参数(arguments)
   # -e：若有一个命令行返回值为非0则退出脚本

:raw-html-m2r:`<img src="https://natsu-akatsuki.oss-cn-guangzhou.aliyuncs.com/img/vc2ZAhmLzlmLH17y.png!thumbnail" alt="img" style="zoom:67%; " />`

`判断语法 <https://www.cnblogs.com/mlfz/p/11427760.html>`_
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

使用中括号作为shell的判断式

.. attention:: 注意空格，[空格... 空格]


命令行补全
----------

`hstr <https://github.com/dvorka/hstr>`_
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

.. prompt:: bash $,# auto

   $ sudo add-apt-repository ppa:ultradvorka/ppa && sudo apt-get update && sudo apt-get install hstr && hstr --show-configuration >> ~/.bashrc && . ~/.bashrc
